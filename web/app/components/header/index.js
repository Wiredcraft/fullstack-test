import React from 'react';
import { LoginContext } from '../context';
import Icon from '../icon';
import styles from './style.less';

class Header extends React.Component {
    static contextType = LoginContext;

    onSearch = e => {
        if (e.keyCode == "13") {
            location.href = `https://www.google.com/search?&q=site:u2pier.com ${this.refs.search.value}`;
        }
    }

    render() {
        const { curTopic } = this.props;
        return (
            <div className={styles.header}>
                <div className={styles.inner}>
                    <div className={styles.logo}>
                        <a href="/">
                            <div>
                                <svg xmlns="http://www.w3.org/2000/svg" width="113.885" height="32.382" viewBox="0 0 113.885 32.382">
                                    <g id="组_53" data-name="组 53" transform="translate(-482.635 -592.635)">
                                        <g id="组_547" data-name="组 547" transform="translate(200.787 -151.201)">
                                            <g id="组_532" data-name="组 532" transform="translate(283.213 745.201)">
                                                <circle id="椭圆_72" data-name="椭圆 72" cx="10.862" cy="10.862" r="10.862" transform="translate(0 18.834) rotate(-60.127)" stroke-width="2" stroke="#5a67d8" stroke-linecap="round" stroke-linejoin="round" stroke-miterlimit="10" fill="none" />
                                                <path id="路径_243" data-name="路径 243" d="M27.168-311.68a10.794,10.794,0,0,1,2.33.416c1.127.352,1.862.9,2.063,1.641.671,2.483-4.959,6.16-12.569,8.215S4.669-299.7,4-302.183a2.613,2.613,0,0,1,.826-2.306" transform="translate(-2.786 321.338)" fill="none" stroke="#5a67d8" stroke-linecap="round" stroke-linejoin="round" stroke-miterlimit="10" stroke-width="2" />
                                                <ellipse id="椭圆_73" data-name="椭圆 73" cx="2.113" cy="1.761" rx="2.113" ry="1.761" transform="translate(23.802 0.563)" fill="none" stroke="#5a67d8" stroke-linecap="round" stroke-linejoin="round" stroke-miterlimit="10" stroke-width="2" />
                                                <ellipse id="椭圆_74" data-name="椭圆 74" cx="1.057" cy="0.704" rx="1.057" ry="0.704" transform="translate(19.575 0.563)" fill="none" stroke="#5a67d8" stroke-linecap="round" stroke-linejoin="round" stroke-miterlimit="10" stroke-width="2" />
                                                <path id="路径_244" data-name="路径 244" d="M21.07-299.865a8.177,8.177,0,0,1,.2-1.325" transform="translate(-14.597 314.104)" fill="none" stroke="#5a67d8" stroke-linecap="round" stroke-linejoin="round" stroke-miterlimit="10" stroke-width="2" />
                                                <path id="路径_245" data-name="路径 245" d="M24.43-317.046a8.342,8.342,0,0,1,5.133-4" transform="translate(-16.915 327.8)" fill="none" stroke="#5a67d8" stroke-linecap="round" stroke-linejoin="round" stroke-miterlimit="10" stroke-width="2" />
                                            </g>
                                        </g>
                                        <g id="组_547-2" data-name="组 547" transform="translate(234.787 -157.201)">
                                            <path id="U2PIER" d="M16.148-15.378a2.592,2.592,0,0,1,1.661.429A2.1,2.1,0,0,1,18.26-13.2q-.022.44-.044.836t-.066.77q-.044.374-.1.77t-.143.858a2.778,2.778,0,0,1-1.243,1.793,4.259,4.259,0,0,1-2.673.6,14.789,14.789,0,0,1-1.551-.154,9.309,9.309,0,0,1-1.353-.319,12.248,12.248,0,0,1-1.342-.517q-.682-.308-1.5-.748-.968-.55-.594-1.254.242-.462.561-.5a1.635,1.635,0,0,1,.825.209q.792.44,1.4.715t1.111.462a5.991,5.991,0,0,0,.979.275,10.031,10.031,0,0,0,1,.132,3.679,3.679,0,0,0,1.925-.209,1.609,1.609,0,0,0,.8-1.089,6.99,6.99,0,0,0,.209-1.122q.055-.55.077-1.32a1.035,1.035,0,0,0-.11-.66.552.552,0,0,0-.44-.154H4.686a.269.269,0,0,0-.2.066.426.426,0,0,0-.066.286v6.2q0,.462.154.583a1.623,1.623,0,0,0,.814.121H17.776A2.906,2.906,0,0,1,19.822-6a2.612,2.612,0,0,1,.506,2.013q-.022.616-.121,1.419T19.976-.924q-.132.836-.308,1.617a11.363,11.363,0,0,1-.374,1.331,3.343,3.343,0,0,1-.616,1.056,3.024,3.024,0,0,1-.858.671,3.583,3.583,0,0,1-1.056.352,6.825,6.825,0,0,1-1.166.1,12.928,12.928,0,0,1-1.892-.154,21.807,21.807,0,0,1-2.42-.528,1.55,1.55,0,0,1-.616-.33.6.6,0,0,1-.154-.616,1.131,1.131,0,0,1,.352-.627.775.775,0,0,1,.77-.077,16.281,16.281,0,0,0,3.938.7A2.553,2.553,0,0,0,17.083,2.2a2.146,2.146,0,0,0,.759-1.122,8.68,8.68,0,0,0,.253-.99q.121-.594.22-1.254t.165-1.276q.066-.616.088-1.056a5.051,5.051,0,0,0-.011-.77.7.7,0,0,0-.176-.429.675.675,0,0,0-.407-.176,5.472,5.472,0,0,0-.66-.033H4.818a4.214,4.214,0,0,1-1.067-.11,1.3,1.3,0,0,1-.638-.363A1.337,1.337,0,0,1,2.8-6.061a6.186,6.186,0,0,1-.077-1.067v-6.358a2.114,2.114,0,0,1,.407-1.441,1.815,1.815,0,0,1,1.4-.451H8.756q.176-.33.319-.66t.253-.638a.847.847,0,0,1,.374-.44.916.916,0,0,1,.638-.088.816.816,0,0,1,.594.363,1.231,1.231,0,0,1-.022.891q-.044.11-.11.264a3.015,3.015,0,0,1-.154.308Zm1.276,13.64a.9.9,0,0,1-.187.583.793.793,0,0,1-.649.231H1.54a.725.725,0,0,1-.627-.231.978.978,0,0,1-.165-.583.993.993,0,0,1,.165-.638.791.791,0,0,1,.627-.2H16.588a.869.869,0,0,1,.649.2A.909.909,0,0,1,17.424-1.738ZM46.882-7.986q.9-.066.968.77a.679.679,0,0,1-.2.605,1.09,1.09,0,0,1-.66.275q-1.518.132-2.9.264l-2.772.264V1.056a1.712,1.712,0,0,0,.044.429.425.425,0,0,0,.264.264,2.366,2.366,0,0,0,.7.143q.484.044,1.386.044a6.262,6.262,0,0,0,1.375-.121A1.234,1.234,0,0,0,45.87,1.3,2.465,2.465,0,0,0,46.2.154q.066-.748.066-1.98a.864.864,0,0,1,.2-.583A.8.8,0,0,1,47.1-2.64a.766.766,0,0,1,.627.253.86.86,0,0,1,.209.561A22.043,22.043,0,0,1,47.817.682a4.014,4.014,0,0,1-.539,1.694,2.362,2.362,0,0,1-1.232.957,6.6,6.6,0,0,1-2.2.3,13.53,13.53,0,0,1-2.211-.143,3.288,3.288,0,0,1-1.265-.44,1.4,1.4,0,0,1-.583-.781,4.061,4.061,0,0,1-.143-1.144V-5.632q-.924.088-1.826.165T35.926-5.3q-.968.066-1.034-.726a.71.71,0,0,1,.22-.66,1.27,1.27,0,0,1,.7-.264q1.012-.088,1.958-.165t1.87-.187v-5.962q-.77.11-1.562.154l-1.584.088a1.276,1.276,0,0,1-.759-.132.664.664,0,0,1-.319-.638.764.764,0,0,1,.308-.649,1.323,1.323,0,0,1,.814-.231q.946-.022,2.09-.132t2.31-.3q1.166-.187,2.288-.418t2.024-.473a1.894,1.894,0,0,1,1-.066.635.635,0,0,1,.385.506.76.76,0,0,1-.11.726,2,2,0,0,1-.836.4q-.814.242-1.936.5t-2.442.451v6.028l2.706-.264Q45.386-7.854,46.882-7.986ZM30.25-3.85q-.55.22-1.089.418t-1.089.374a1.609,1.609,0,0,1-.77.1.535.535,0,0,1-.418-.429,1.048,1.048,0,0,1,.022-.825,1.228,1.228,0,0,1,.77-.5q.616-.2,1.276-.429t1.3-.517v-5.588H27.786a.832.832,0,0,1-.671-.209,1,1,0,0,1-.165-.627.872.872,0,0,1,.187-.616.869.869,0,0,1,.649-.2H30.25V-16.28a.84.84,0,0,1,.209-.649.844.844,0,0,1,.583-.187.915.915,0,0,1,.627.187.84.84,0,0,1,.209.649v3.388h2q.88,0,.88.814,0,.836-.88.836h-2v4.8a10.084,10.084,0,0,0,1.232-.792,1.18,1.18,0,0,1,.792-.3.743.743,0,0,1,.572.385.847.847,0,0,1,.165.671,1.264,1.264,0,0,1-.539.627,17.008,17.008,0,0,1-2.222,1.3v6.2a2.362,2.362,0,0,1-.407,1.562,1.756,1.756,0,0,1-1.375.462,3.858,3.858,0,0,1-.88-.121q-.506-.121-1.1-.319a1.018,1.018,0,0,1-.572-.4.738.738,0,0,1-.022-.726q.286-.726,1.188-.418a3.062,3.062,0,0,0,.473.132l.473.088a.65.65,0,0,0,.462-.022q.132-.088.132-.44ZM64.68-2.332a.761.761,0,0,1-.253.638.986.986,0,0,1-.627.2H59a10.847,10.847,0,0,1-1.54,2.739,11.186,11.186,0,0,1-2.178,2.1q-1.144.814-1.628.066a.862.862,0,0,1-.088-.66q.088-.352.814-.858A9.6,9.6,0,0,0,55.913.429,9.092,9.092,0,0,0,57.134-1.5H54.56a.9.9,0,0,1-.649-.242.79.79,0,0,1-.253-.594.816.816,0,0,1,.253-.616.9.9,0,0,1,.649-.242h3.212a17.467,17.467,0,0,0,.4-1.925,19.914,19.914,0,0,0,.2-2.233h-3.08a.936.936,0,0,1-.638-.231.741.741,0,0,1-.264-.583.8.8,0,0,1,.264-.616.911.911,0,0,1,.638-.242h3.08V-13.2H54.934a.977.977,0,0,1-.649-.231.729.729,0,0,1-.275-.583.806.806,0,0,1,.275-.594.906.906,0,0,1,.649-.264h3.432V-16.3a.828.828,0,0,1,.231-.66,1,1,0,0,1,.671-.2.774.774,0,0,1,.572.22.864.864,0,0,1,.22.638v1.43H63.6a.952.952,0,0,1,.627.209.794.794,0,0,1,.253.649q0,.814-.88.814H60.06v4.18h3.146a1,1,0,0,1,.616.2.772.772,0,0,1,.264.66.729.729,0,0,1-.253.627,1.026,1.026,0,0,1-.627.187H60.038q-.044,1.188-.165,2.211a17.055,17.055,0,0,1-.341,1.947H63.8a1,1,0,0,1,.616.2A.772.772,0,0,1,64.68-2.332Zm9.174-.352A3.976,3.976,0,0,1,72.941.154a3.22,3.22,0,0,1-2.343.924,7.626,7.626,0,0,1-1.3-.11A8.226,8.226,0,0,1,67.76.506a1.086,1.086,0,0,1-.528-.451.768.768,0,0,1-.066-.693.824.824,0,0,1,.506-.517,1.058,1.058,0,0,1,.792.077,5.192,5.192,0,0,0,1.155.418,4.806,4.806,0,0,0,1,.11A1.153,1.153,0,0,0,71.6-.968a2.889,2.889,0,0,0,.473-1.188,3.626,3.626,0,0,0-.418-2.178,8.747,8.747,0,0,0-1.848-2.508,2.035,2.035,0,0,1-.671-1.342A3.766,3.766,0,0,1,69.5-9.812l1.716-4.158q.176-.374.088-.484t-.462-.11h-3.5q-.352,0-.352.462V3.256a.734.734,0,0,1-.209.605,1,1,0,0,1-.627.165,1.225,1.225,0,0,1-.66-.143q-.22-.143-.22-.627V-14.278a2.072,2.072,0,0,1,.44-1.5,1.894,1.894,0,0,1,1.386-.44h4.686a1.4,1.4,0,0,1,.693.165,1.4,1.4,0,0,1,.484.44,1.508,1.508,0,0,1,.242.616,1.339,1.339,0,0,1-.077.693l-2,4.84a3.294,3.294,0,0,0-.3.99.719.719,0,0,0,.231.55,9.5,9.5,0,0,1,2.134,2.662A5.46,5.46,0,0,1,73.854-2.684Z" transform="translate(287.878 772.877)" fill="#5a67d8" />
                                        </g>
                                    </g>
                                </svg>
                            </div>
                        </a>
                    </div>
                    <div className={styles.middle}></div>
                    <div className={styles.search}>
                        <i></i>
                        <input ref="search" onKeyDown={this.onSearch} />
                    </div>
                    <div className={styles.right}>
                        <a href="/guide">新手入门</a>
                        {this.context ? (
                            <>
                                <a href="/admin?tab=message" className={styles.message}>消息 {parseInt(this.context.messages) > 0 && (<em>{this.context.messages}</em>)}</a>
                                <a href="/admin">{this.context.name}</a>
                                <a href="/logout">退出</a>
                            </>
                        ) : (
                                <>
                                    <a href="/register">注册</a>
                                    <a href="/login">登录</a>
                                </>
                            )}
                    </div>
                </div>
                <div className={styles.topics}>
                    <div className={styles.inner}>
                        <ul>
                            <li className={curTopic && curTopic.id == 0 && styles.selected}><a href="/">全部</a></li>
                            {this.props.topics.map(item => (
                                <li className={curTopic && curTopic.id == item.id && styles.selected}><a href={`/topic/${item.id}`}>{item.name}</a></li>
                            ))}
                        </ul>
                        <a className={styles.publish} href={`/add?topic=${curTopic ? (curTopic.name || '') : ''}`}>
                            <Icon type="pencil" />
                            发布主题
                        </a>
                    </div>
                </div>
            </div>
        )
    }
}

export default Header;